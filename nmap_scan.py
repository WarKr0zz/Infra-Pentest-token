import nmap

def nmap_scan(target_ip):
    nm = nmap.PortScanner()
    nm.scan(target_ip, arguments='-sV')
    services = []

    if target_ip not in nm.all_hosts():
        print(f"Aucun résultat de scan trouvé pour l'hôte {target_ip}")
        return services

    for proto in nm[target_ip].all_protocols():
        lport = nm[target_ip][proto].keys()
        for port in lport:
            service = nm[target_ip][proto][port]['name']
            version = nm[target_ip][proto][port]['version']
            services.append((port, service, version))
    return services

